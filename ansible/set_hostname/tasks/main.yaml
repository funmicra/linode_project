---
- name: Determine hostname dynamically
  set_fact:
    custom_hostname: >-
      {% if 'proxy' in group_names %}
        proxy
      {% elif 'private' in group_names %}
        private-{{ groups['private'].index(inventory_hostname) }}
      {% else %}
        {{ inventory_hostname_short }}
      {% endif %}
  # strip whitespace
  vars:
    custom_hostname: "{{ custom_hostname | trim }}"

- name: Set hostname
  hostname:
    name: "{{ custom_hostname }}"
  become: true

- name: Update /etc/hosts for hostname resolution
  lineinfile:
    path: /etc/hosts
    regexp: '127\.0\.1\.1'
    line: "127.0.1.1 {{ custom_hostname }}"
    state: present
  become: true

- name: Show hostname for verification
  debug:
    msg: "{{ custom_hostname }}"
